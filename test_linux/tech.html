<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinel Full Data Audit</title>
    <style>
        body { font-family: "Courier New", monospace; background: #0a0a0a; color: #00ff41; padding: 20px; font-size: 13px; }
        .audit-container { max-width: 900px; margin: 0 auto; border: 1px solid #333; padding: 20px; background: #000; }
        h1 { font-size: 18px; border-bottom: 2px solid #00ff41; padding-bottom: 10px; color: #fff; }
        h2 { font-size: 14px; color: #00ff41; margin-top: 30px; background: #111; padding: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 10px; border: 1px solid #333; background: #1a1a1a; color: #aaa; font-size: 11px; }
        td { padding: 10px; border: 1px solid #222; }

        .tag { padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: bold; }
        .tag-peri { background: #4b0082; color: white; }
        .tag-int { background: #333; color: #888; }
        
        .status-open { color: #ff3e3e; font-weight: bold; }
        .status-closed { color: #00ff41; }
        
        .raw-json { background: #111; padding: 10px; border-radius: 5px; color: #888; overflow-x: auto; font-size: 11px; margin-top: 20px; border: 1px dashed #333; }
        .btn-box { margin-bottom: 20px; }
        .btn { background: #00ff41; color: #000; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; font-family: inherit; }
    </style>
</head>
<body>

<div class="audit-container">
    <h1>SENTINEL SYSTEM DATA AUDIT</h1>
    
    <div class="btn-box">
        <button class="btn" onclick="location.href='index.html'">BACK TO DASHBOARD</button>
        <button class="btn" onclick="fetchData()" style="background:#444; color:#fff;">REFRESH DATA</button>
    </div>

    <h2>[SYSTEM_STRUCT]</h2>
    <table>
        <tr><th>FIELD</th><th>VALUE</th><th>RAW TYPE</th></tr>
        <tr><td>siteName</td><td id="sys-name">--</td><td>char[STR_MEDIUM]</td></tr>
        <tr><td>arm_state</td><td id="sys-state">--</td><td>int (enum)</td></tr>
        <tr><td>is_ready</td><td id="sys-ready">--</td><td>bool (computed)</td></tr>
    </table>

    <h2>[ZONE_STRUCT_ARRAY]</h2>
    <table id="zone-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>NAME</th>
                <th>TYPE</th>
                <th>GPIO</th>
                <th>PERIMETER</th>
                <th>RAW_VALUE</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>[RELAY_STRUCT_ARRAY]</h2>
    <table id="relay-table">
        <thead>
            <tr>
                <th>NAME</th>
                <th>TYPE</th>
                <th>GPIO</th>
                <th>ACTIVE_STATE</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>[RAW_API_RESPONSE]</h2>
    <div class="raw-json" id="raw-output">Requesting stream...</div>
</div>

<script>
    async function fetchData() {
        const out = document.getElementById('raw-output');
        try {
            const res = await fetch('/api/status?t=' + Date.now());
            const data = await res.json();
            
            // Raw JSON View
            out.innerText = JSON.stringify(data, null, 4);

            // System
            document.getElementById('sys-name').innerText = data.siteName;
            document.getElementById('sys-state').innerText = data.state;
            document.getElementById('sys-ready').innerText = data.is_ready.toString().toUpperCase();

            // Zones
            const zBody = document.querySelector('#zone-table tbody');
            zBody.innerHTML = '';
            data.zones.forEach(z => {
                zBody.innerHTML += `
                    <tr>
                        <td>${z.id}</td>
                        <td>${z.name}</td>
                        <td>${z.type}</td>
                        <td>PIN_${z.gpio}</td>
                        <td><span class="tag ${z.peri ? 'tag-peri' : 'tag-int'}">${z.peri ? 'TRUE' : 'FALSE'}</span></td>
                        <td class="${z.violated ? 'status-open' : 'status-closed'}">${z.violated ? '0 (VIOLATED)' : '1 (SECURE)'}</td>
                    </tr>
                `;
            });

            // Relays
            const rBody = document.querySelector('#relay-table tbody');
            rBody.innerHTML = '';
            data.relays.forEach(r => {
                rBody.innerHTML += `
                    <tr>
                        <td>${r.name}</td>
                        <td>${r.type}</td>
                        <td>PIN_${r.gpio}</td>
                        <td class="${r.active ? 'status-open' : 'status-closed'}">${r.active ? '1 (HIGH)' : '0 (LOW)'}</td>
                    </tr>
                `;
            });

        } catch (e) {
            out.innerText = "Error fetching data: " + e.message;
        }
    }

    fetchData();
    setInterval(fetchData, 5000);
</script>

</body>
</html>
