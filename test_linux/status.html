<!DOCTYPE html>
<html>
<head>
    <title>Sentinel Maintenance</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .item { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .item.active { background: #fff1f0; border-color: #ffa39e; color: #cf1322; }
        .btn { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: 0.2s; }
        .btn-back { background: #555; color: white; margin-bottom: 20px; }
        .btn-trip { background: #fafafa; border: 1px solid #d9d9d9; }
        .btn-trip:hover { background: #e6e6e6; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.9rem; font-weight: bold; }
        .on { color: #52c41a; }
        .off { color: #bfbfbf; }
    </style>
</head>
<body>

    <button class="btn btn-back" onclick="window.location.href='/'">← BACK TO KEYPAD</button>

    <div class="card">
        <h2>System Status: <span id="sysState" style="color:#1890ff;">LOADING...</span></h2>
        <p>Site: <strong id="siteName">--</strong></p>
    </div>

    <h3>Zones (Sensors)</h3>
    <div id="zGrid" class="grid"></div>

    <h3 style="margin-top: 30px;">Relays (Outputs)</h3>
    <div id="rGrid" class="grid"></div>

    <script>
        const STATE_NAMES = ["DISARMED", "EXIT DELAY", "ARMED", "ENTRY DELAY", "ALARMED"];

        function trigger(id) {
            fetch(`/api/trigger?id=${id}`, { method: 'POST' })
                .then(() => update());
        }

        function update() {
            fetch('/api/status')
                .then(r => r.json())
                .then(data => {
                    // 1. Update Header Info
                    // data.siteName comes from config.name in C
                    document.getElementById('siteName').innerText = data.siteName || "Unknown Site";
                    document.getElementById('sysState').innerText = STATE_NAMES[data.state] || "UNKNOWN";

                    // 2. Render Zones Grid
                    document.getElementById('zGrid').innerHTML = data.zones.map(z => `
                        <div class="item ${z.violated ? 'active' : ''}">
                            <div>
                                <strong>${z.name}</strong><br>
                                <small>${z.type.toUpperCase()}</small>
                            </div>
                            <button class="btn btn-trip" onclick="trigger(${z.id})">
                                ${z.violated ? 'RESET' : 'TRIP'}
                            </button>
                        </div>
                    `).join('');

                    // 3. Render Relays Grid
                    document.getElementById('rGrid').innerHTML = data.relays.map(r => `
                        <div class="item">
                            <div><strong>${r.name}</strong><br><small>${r.type}</small></div>
                            <span class="status-badge ${r.active ? 'on' : 'off'}">
                                ${r.active ? '● ACTIVE' : '○ READY'}
                            </span>
                        </div>
                    `).join('');
                })
                .catch(err => {
                    console.error("Connection lost to Sentinel API", err);
                    document.getElementById('sysState').innerText = "OFFLINE";
                });
        }

        // Poll the system every 2 seconds
        setInterval(update, 2000);
        update();
    </script>
</body>
</html>