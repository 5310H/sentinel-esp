<!DOCTYPE html>
<html>
<head>
    <title>Sentinel Dashboard</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .item { border: 1px solid #ddd; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .item.active { background: #fff1f0; border-color: #ffa39e; }
        .btn { padding: 8px 16px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; }
        .btn-arm { background: #1890ff; color: white; }
        .btn-disarm { background: #ff4d4f; color: white; }
        .btn-trip { background: #fafafa; border: 1px solid #d9d9d9; }
    </style>
</head>
<body>

<div class="card">
    <h2>Status: <span id="sysState">--</span></h2>
    <p>config: <strong id="config">--</strong></p>
    <button class="btn btn-arm" onclick="cmd('arm')">ARM SYSTEM</button>
    <button class="btn btn-disarm" onclick="cmd('disarm')">DISARM</button>
</div>

<h3>Zones</h3>
<div id="zGrid" class="grid"></div>

<h3>Relays</h3>
<div id="rGrid" class="grid"></div>

<script>
    function cmd(type) {
        fetch(`/api/${type}`, { method: 'POST' }).then(() => update());
    }

    function trigger(id) {
        fetch(`/api/trigger?id=${id}`, { method: 'POST' }).then(() => update());
    }

    function update() {
        fetch('/api/config').then(r => r.json()).then(data => {
            document.getElementById('sysState').innerText = data.state;
            document.getElementById('config').innerText = data.config;

            document.getElementById('zGrid').innerHTML = data.zones.map(z => `
                <div class="item ${z.violated ? 'active' : ''}">
                    <div><strong>${z.name}</strong><br><small>${z.type}</small></div>
                    <button class="btn btn-trip" onclick="trigger(${z.id})">TRIP</button>
                </div>
            `).join('');

            document.getElementById('rGrid').innerHTML = data.relays.map(r => `
                <div class="item ${r.state ? 'active' : ''}">
                    <div><strong>${r.name}</strong></div>
                    <span>${r.state ? '● ON' : '○ OFF'}</span>
                </div>
            `).join('');
        });
    }

    setInterval(update, 2000);
    update();
</script>
</body>
</html>